### **Название задачи:** 
Концептуальная архитектура MVP процесса открытия депозитов через цифровые каналы (сайт и интернет-банк)

### **Автор:**
Команда цифровой трансформации

### **Дата:**
13.02.2026

### **Функциональные требования**

| **№** | **Действующие лица или системы** | **Use Case** | **Описание** |
|:-----:|----------------------------------|--------------|--------------|
| UC1 | Клиент, Сайт | Просмотр депозитов на сайте | Клиент (новый/существующий) заходит на сайт банка, видит список депозитов с актуальными ставками |
| UC2 | Клиент, Сайт | Подача заявки на депозит с сайта | Новый клиент заполняет ФИО и телефон, существующий — только телефон. Заявка передаётся в систему |
| UC3 | Система, Кол-центр | Обработка заявки с сайта | Менеджер кол-центра видит заявку в своей системе, связывается с клиентом, может предложить особые условия |
| UC4 | Клиент, Интернет-банк | Просмотр депозитов в ИБ | Клиент авторизуется в интернет-банке, видит общие ставки и персонализированные предложения |
| UC5 | Клиент, Интернет-банк | Подача заявки на депозит в ИБ | Клиент выбирает счёт и сумму, подтверждает операцию СМС-кодом |
| UC6 | Клиент, Отделение | Идентификация нового клиента | Новый клиент приходит в отделение для идентификации (юридическое требование) |
| UC7 | Сотрудник отделения, АБС | Оформление депозита | Сотрудник подтверждает условия в АБС, создаёт депозит, загружает документы |
| UC8 | Сотрудник бэк-офиса, АБС | Управление ставками | Сотрудники депозитного и кредитного бэк-офиса управляют ставками через АБС (новый модуль) |
| UC9 | Система, СМС-шлюз | Отправка уведомлений | Клиент получает СМС: подтверждение ставки, подтверждение открытия депозита, СМС-код для подтверждения операций |

### **Нефункциональные требования**

| **№** | **Требование** |
|:-----:|----------------|
| NFR1 | Доступность сервисов 99.9% в режиме 24/7 |
| NFR2 | Отклик интерфейса в миллисекундах, загрузка справочников < 1 сек |
| NFR3 | Изоляция от нагрузки на АБС — исключить синхронные вызовы к API АБС из интернет-банка |
| NFR4 | Горизонтальное масштабирование новых компонентов |
| NFR5 | Шифрование трафика (HTTPS) для всех внешних каналов |
| NFR6 | Соответствие 152-ФЗ и требованиям к ПДн |
| NFR7 | Приоритет существующих технологий: PostgreSQL, Oracle, Java |
| NFR8 | Микросервисная архитектура для нового функционала (стратегически) |
| NFR9 | Исключение доработок ядра интернет-банка подрядчиком — реализация внутренними силами |
| NFR10 | Обмен с АБС только асинхронный, без прямых запросов от интерфейсов |
| NFR11 | Совместимость с существующей платформой (текущая версия ИБ несовместима с Kafka) |
| NFR12 | Техническая документация для сопровождения и расширения |
| NFR13 | Мониторинг и логирование новых сервисов |

### **Решение**

#### **Логика принятия решений**

При разработке концептуальной архитектуры мы руководствовались следующими принципами:

1. **Асинхронность и изоляция** — главное ограничение: АБС перегружена, масштабируется только вертикально. Любой синхронный вызов из интернет-банка в АБС создаёт критический риск. Поэтому все взаимодействия с АБС должны быть асинхронными, через промежуточный слой.

2. **Стратегический переход на микросервисы** — мы начинаем с депозитного функционала. Это позволяет накопить экспертизу и постепенно уходить от монолитной платформы интернет-банка.

3. **Адаптация под существующие ограничения** — текущая платформа ИБ несовместима с Kafka, поэтому для MVP мы используем REST API с синхронным вызовом к новому слою микросервисов, а внутри контура уже используем асинхронные очереди.

4. **Реализация без подрядчика** — весь новый функционал (микросервисы, работа со ставками) делается силами команды банка. Это требует чёткого выделения границ ответственности и API-контрактов.

5. **Единый источник ставок** — отказ от XLS-файлов в пользу модуля в АБС, доступного обоим бэк-офисам.

---

#### **Диаграмма контекста (C4 — Context)**

*Файл: [Диаграмма контекста](https://github.com/AlexanderMATI/architecture-pro-standart/blob/main/Task3/Task3%20Context.puml)

**Описание диаграммы контекста:**

Диаграмма контекста показывает систему открытия депозитов на верхнем уровне. В центре находится новая система **DORS (Deposit Opening Router Service)**, которая становится единым входным шлюзом для всех заявок с цифровых каналов.

**Внешние акторы:**
- **Клиент** — взаимодействует с Сайтом и Интернет-банком.
- **Сотрудник отделения** — работает в АБС, оформляет депозиты.
- **Сотрудник бэк-офиса (депозиты)** — управляет ставками.
- **Сотрудник бэк-офиса (кредиты)** — участвует в расчёте ставок.
- **Сотрудник кол-центра** — обрабатывает заявки с сайта.

**Внешние системы:**
- **Сайт банка** — публичный портал.
- **Интернет-банк** — существующая ДБО-система.
- **АБС** — ядро банковской системы.
- **Система кол-центра** — CRM для операторов.
- **СМС-шлюз** — отправка уведомлений.
- **Телеком-оператор** — внешний провайдер СМС.

**Ключевые интеграции:**
- Сайт и Интернет-банк отправляют заявки в DORS по REST/HTTPS.
- DORS асинхронно передаёт заявки в АБС через Kafka.
- DORS вызывает СМС-шлюз для отправки уведомлений.
- АБС взаимодействует с системой кол-центра и сотрудниками.

---

#### **Диаграмма контейнеров (C4 — Containers)**

*Файл: [Диаграмма контейнеров](https://github.com/AlexanderMATI/architecture-pro-standart/blob/main/Task3/Task3%20Container.puml)

**Описание диаграммы контейнеров:**

Диаграмма контейнеров детализирует внутреннюю структуру ключевых систем.

**1. Интернет-банк (существующий монолит):**
- **Модуль-адаптер ИБ** — новый компонент, реализованный командой банка без привлечения подрядчика. Вызывает REST API сервиса DORS.

**2. DORS (Deposit Opening Router Service) — новый микросервис:**
- **API Gateway** — принимает запросы от каналов (REST/HTTPS).
- **Orchestrator** — управляет жизненным циклом заявки, реализует бизнес-логику.
- **БД заявок (MS SQL)** — хранит статусы, идентификаторы, метаданные заявок.
- **Kafka Producer** — отправляет события в очередь Kafka.
- **Stateless-архитектура** — обеспечивает горизонтальное масштабирование.

**3. Очередь сообщений:**
- **Kafka** — брокер сообщений, обеспечивает асинхронную доставку заявок в АБС.

**4. Адаптер для АБС:**
- **Kafka Consumer Adapter** — промежуточный сервис, читает события из Kafka и записывает заявки в АБС через существующие интерфейсы (Oracle JDBC / API).

**5. АБС (Автоматизированная банковская система):**
- **Модуль приёма заявок (новый)** — доработка АБС для получения заявок из адаптера.
- **Модуль управления ставками (новый)** — замена XLS-файлов, единый источник ставок для депозитного и кредитного бэк-офиса.
- **UI АБС** — интерфейс для сотрудников отделения и бэк-офиса.

**6. Сервис уведомлений:**
- **Сервис уведомлений (новый микросервис)** — вызывает ядро СМС через его API. Реализуется без доработок ядра подрядчиком.
- **Ядро СМС** — существующая система, API для отправки сообщений.

**Все компоненты DORS и сервис уведомлений разрабатываются с использованием Java, Spring Boot, MS SQL. Код полностью контролируется командой банка.**

---

### **Альтернативы**

| **Альтернатива** | **Описание** | **Причина отклонения** |
|------------------|--------------|------------------------|
| Прямая интеграция ИБ с АБС через API | Синхронные вызовы из ИБ в АБС | Нарушает NFR3, NFR10. Риск отказа АБС из-за нагрузки |
| Реализация всей логики внутри существующего ИБ | Доработка монолита подрядчиком | Нарушает NFR9. Высокая стоимость, зависимость от вендора |
| RabbitMQ вместо Kafka | Альтернативная очередь сообщений | Экспертиза банка — Java, Kafka выбрана стратегически (NFR4, +R4). Текущая платформа ИБ несовместима с Kafka, но внутри контура Kafka предпочтительнее |
| Полный редизайн ИБ под микросервисы сразу | Высокий риск и стоимость для MVP | Принята стратегия постепенной миграции, начиная с депозитов |
| Сохранение XLS-файлов для ставок | Нулевые затраты на разработку | Нефункционально, не масштабируется, высокий риск ошибок ручного ввода |

---

### **Недостатки, ограничения, риски**

| **Риск/Ограничение** | **Описание** | **Способ снижения/Комментарий** |
|-----------------------|-------------|----------------------------------|
| **Ограничение** | АБС не поддерживает Kafka напрямую | Создаётся адаптер — отдельный сервис, который читает Kafka и пишет в БД АБС через существующие интерфейсы |
| **Риск** | Новая очередь (Kafka) — недостаток экспертизы в команде | Пилотный проект на депозитном процессе, обучение команды, проведение PoC |
| **Риск** | Адаптер в интернет-банке — потенциальные конфликты с существующим монолитом | Чёткое выделение кода, изоляция изменений, минимизация вторжения в ядро |
| **Риск** | Производительность DORS на старте | Горизонтальное масштабирование, stateless-архитектура, балансировка нагрузки |
| **Ограничение** | Новый модуль в АБС — требуется доработка системы | Необходимо согласование с командой АБС, выделение ресурсов на разработку и тестирование |
| **Риск** | Сроки реализации MVP | Выбран минимально жизнеспособный функционал, параллельная работа нескольких команд |
| **Ограничение** | Юридические требования (идентификация в отделении) | Не является техническим риском, но влияет на UX и требует отражения в клиентском пути |
| **Ограничение** | Невозможность полностью отказаться от ручных операций на этапе MVP | Часть процессов (специальные ставки, сложные согласования) остаются ручными на первом этапе |
| **Риск** | Отсутствие мониторинга новых сервисов на старте | Заложить создание дашбордов и алертов в скоуп работ с первого спринта |
| **Риск** | Документация не успевает за разработкой | Включить требование по документации в Definition of Done |

---

**Вывод:**

Предложенная архитектура полностью удовлетворяет всем функциональным и нефункциональным требованиям MVP, учитывает существующие ограничения ИТ-ландшафта банка и закладывает фундамент для дальнейшего развития цифровых каналов и стратегического перехода к микросервисной архитектуре.

Ключевые архитектурные решения — **асинхронная интеграция с АБС, выделение слоя микросервисов Депозитных заявок, реализация силами внутренней команды** — позволяют достичь целей проекта с минимальными рисками и оптимальными затратами.

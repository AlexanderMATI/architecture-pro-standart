@startuml
!include <C4/C4_Container>

skinparam {
    backgroundColor #FAFAFA
    roundCorner 20
    shadowing true
    wrapWidth 200
}
LAYOUT_WITH_LEGEND()

Person(client, "Клиент")

System_Ext(site, "Сайт", "PHP, React.js")
System_Ext(ib, "Интернет-банк", "ASP.NET")
System_Ext(call_center_system, "Система кол-центра")
System_Ext(abs, "АБС", "Delphi, Oracle")

System_Boundary(c1, "Сервис депозитных заявок") {
    Container(api, "API-приложение", "Java, Spring Boot", "Принимает, валидирует и сохраняет заявки")
    ContainerDb(db, "База данных заявок", "PostgreSQL", "Хранит все онлайн-заявки")
}

ContainerDb(staging_db, "Middleware БД", "PostgreSQL", "Таблица для асинхронной передачи заявок в АБС")

Rel(client, site, "Подает заявку")
Rel(client, ib, "Подает заявку")

Rel(site, api, "Отправляет заявку", "JSON/HTTPS")
Rel(ib, api, "Отправляет заявку", "JSON/HTTPS")

Rel(api, db, "Сохраняет/Читает заявку", "JDBC")
Rel(api, call_center_system, "Создает обращение", "API")
Rel(api, staging_db, "Записывает заявку для АБС", "JDBC")

Rel(abs, staging_db, "Читает новые заявки (batch job)", "ETL")

@enduml